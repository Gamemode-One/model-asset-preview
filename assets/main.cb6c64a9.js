import{W as e,P as t,O as a,S as n,A as i,C as s,c as o,a as r,G as l,B as d,b as u,d as h,V as c,e as p,i as v,r as g,f as m,o as w,w as f,g as b,h as y,j as R,u as x,F as M,k as P,l as k,m as I,n as j,t as C,p as E,q as A,v as q,s as Y,x as z,y as B,z as O,D}from"./vendor.37d1ecbd.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,s)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),i(l)},onload(){a(self[t].moduleMap[o]),i(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/model-asset-preview/assets/");class F{constructor(r,l,d,u){var h,c;this.canvasElement=r,this.texturePath=d,this.options=u,this.renderingRequested=!1,this.renderer=new e({canvas:r,antialias:null!=(h=u.antialias)&&h,preserveDrawingBuffer:!0,precision:"highp"}),this.renderer.setPixelRatio(window.devicePixelRatio),this.camera=new t(70,1,.1,1e3),this.camera.position.x=-20,this.camera.position.y=20,this.camera.position.z=-20,this.controls=new a(this.camera,r),this.scene=new n,this.scene.add(new i(16777215)),this.scene.background=new s(null!=(c=u.backgroundColor)?c:1184274),this.model=new o(l,d),this.scene.add(this.model.getModel()),window.addEventListener("resize",(()=>this.onResize(!0))),this.controls.addEventListener("change",(()=>this.requestRendering())),this.onResize(!1)}updateModel(e,t){const a=this.model;this.model=new o(e,t),this.scene.add(this.model.getModel()),this.scene.remove(a.getModel())}get width(){var e;return null!=(e=this.options.width)?e:window.innerWidth}get height(){var e;return null!=(e=this.options.height)?e:window.innerHeight}render(e=!0){this.controls.update(),this.renderer.render(this.scene,this.camera),this.renderingRequested=!1,e&&this.model.shouldTick&&(this.model.tick(),this.requestRendering())}requestRendering(e=!1){if(e)return this.render(!1);this.renderingRequested||(this.renderingRequested=!0,requestAnimationFrame((()=>this.render())))}onResize(e=!0){this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.renderer.setSize(this.width,this.height,!0),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),e&&this.requestRendering()}addHelpers(){this.scene.add(new r(50)),this.scene.add(new l(20,20)),this.scene.add(new d(this.model.getModel(),16776960)),this.requestRendering()}getModel(){return this.model}positionCamera(e=1.5,t=!0){t&&this.model.getModel().rotation.set(0,Math.PI,0);const a=(new u).setFromObject(this.model.getModel()).getBoundingSphere(new h),n=this.camera.fov*Math.PI/180*e,i=a.radius/Math.tan(n/2),s=Math.sqrt(Math.pow(i,2)+Math.pow(i,2));this.camera.position.set(s,s,s),this.controls.update(),this.camera.lookAt(a.center),this.controls.target.set(a.center.x,a.center.y,a.center.z),this.camera.updateProjectionMatrix()}async generatePreview(e=1.5,t=10,a=1184274){const n=new OffscreenCanvas(1400*t,600*t),i=n.getContext("2d");if(!i)return;i.imageSmoothingEnabled=!1;const s=this.model.getModel();this.positionCamera(e);const o=[];for(let u=0;u<5;u++)1===u&&s.rotateY(Math.PI/4),0!==u&&s.rotateY(Math.PI/2),this.render(!1),o.push(this.canvasElement.toDataURL("image/png"));const r=(new u).setFromObject(this.model.getModel()).getCenter(new c);s.position.setY(r.y),s.rotation.set(.25*Math.PI,1.75*Math.PI,.75*Math.PI),this.positionCamera(e,!1),this.render(!1),o.push(this.canvasElement.toDataURL("image/png")),s.position.setY(0),s.rotation.set(0,1.75*Math.PI,1.75*Math.PI),this.positionCamera(e,!1),this.render(!1),o.push(this.canvasElement.toDataURL("image/png"));const[l,d,...h]=await Promise.all([this.loadImage(this.texturePath),this.loadImage("./gm1.webp"),...o.map((e=>this.loadImage(e)))]);i.fillStyle="#"+a.toString(16),i.fillRect(0,0,n.width,n.height),i.drawImage(h[0],0,100*t,400*t,400*t/this.camera.aspect);for(let u=0;u<3;u++)i.drawImage(h[u+1],650*t,200*u*t,200*t,200*t/this.camera.aspect);for(let u=0;u<3;u++)i.drawImage(h[u+4],1050*t,200*u*t,200*t,200*t/this.camera.aspect);i.drawImage(l,400*t,200*t,200*t,200*t),i.drawImage(d,n.width-50*t,n.height-50*t,50*t,50*t),n.convertToBlob().then((e=>URL.createObjectURL(e))).then((e=>window.open(e)))}loadImage(e){return new Promise((t=>{const a=new Image;a.src=e,a.addEventListener("load",(()=>t(a)))}))}}const L={style:{display:"flex","justify-items":"center","align-items":"center"}},S={key:0,style:{"list-style-type":"none","padding-left":"0","padding-right":"24px"}};var U=p({expose:[],props:{texture:String,model:Object,quality:{type:Number,default:10}},emits:["ready"],setup(e,{emit:t}){var a,n,i;const o=e,r=null!=(a=v("startRender"))?a:g(!0),l=null!=(n=v("zoom"))?n:g(1.5),d=null!=(i=v("backgroundColor"))?i:g(1.5),u=m((()=>500*o.quality)),h=m((()=>500*o.quality)),c=g(void 0);let p;const E=g([]);function A(e,t=!e.visible,a=!0){"Group"===e.type&&(e.visible=t,a||(e.userData.forcedVisibility=!e.userData.forcedVisibility));for(const n of e.children)A(n,t,!1);p.requestRendering()}return w((()=>{c.value&&(p=new F(c.value,o.model,o.texture,{width:500,height:500,antialias:!0,backgroundColor:d.value}),p.onResize(),p.positionCamera(l.value),setTimeout((async()=>{p.requestRendering(!0)}),10),E.value=[...p.getModel().getBoneMap().entries()])})),f([o,l,d],(()=>{var e;if(r.value||!c.value)return;p.scene.background=new s(null!=(e=d.value)?e:1184274),p.updateModel(o.model,o.texture),p.onResize(),p.positionCamera(l.value);const t=p.getModel().getBoneMap();for(const[a,n]of E.value)n.visible||A(t.get(a),!1);E.value=[...p.getModel().getBoneMap().entries()],setTimeout((async()=>{p.requestRendering(!0)}),10)})),b((()=>{if(!r.value||!c.value)return;p=new F(c.value,o.model,o.texture,{width:u.value,height:h.value,antialias:!0,backgroundColor:d.value});const e=p.getModel().getBoneMap();for(const[t,a]of E.value)a.visible||A(e.get(t),!1);p.onResize(),p.positionCamera(),setTimeout((async()=>{p.requestRendering(!0),await p.generatePreview(l.value,o.quality,d.value),t("ready")}),10)})),(e,t)=>(y(),R("div",L,[E.value.length>0&&!x(r)?(y(),R("ul",S,[(y(!0),R(M,null,P(E.value,(([e,t])=>(y(),R("li",null,[I("input",{type:"checkbox",name:"Toggle Visibility",checked:t.visible,disabled:t.userData.forcedVisibility,onChange:e=>A(t)},null,40,["checked","disabled","onChange"]),j(" "+C(e),1)])))),256))])):k("",!0),I("canvas",{style:{display:x(r)?"none":void 0,width:x(u),height:x(h),borderRadius:"12px",outline:"none"},ref:c},null,4)]))}});const T=I("div",{class:"d-flex"},[I("img",{alt:"Vue logo",src:"data:image/webp;base64,UklGRjIFAABXRUJQVlA4TCYFAAAvY8AYAD8Ft5EkR1Lk3N1T/8187aVj5QaDto0kuXv8aR2pL5DbRpIkMaq7/bd03jN7av5jVfya6/iIRriAETaZQDjEcQRjSPg3HCPmwZwRiMgYJMMwgjEC4c/FLTdhc4QLEwQhGcZgCiYYHEz+BcEtBGIQwmUYjuEQwUgIGRIeB4QjkxFMMIaEIwcThCUhZDiGC/PXy+uOGEjYYPb8G5hcHj4mE/6QJ7pgOjlduFxxf3Lfm0Nj5x9/hhcElyPnz37u8o6NoUMHI4jz8z8aexGD8cYgFPS3bU/bVvIOJYeTjpcyw5iZ2rinTKOcZPZ4c8fMzMzM+H/OknL1Un/e9b3fF9F/B24jKVIN6ThH6X5D+CPhkbcisI2gCJiNx9linzpEhIQBFhIhYoCJiJhFGGywEbGjyQFap05OiQhPXZVnihl4aisKNKt80tTVrVMZYUBoNXnIxWRgUb0yxqw+YmijfknPLE8BE/4GahbZ2OoXubmRW+vHm1nQw6JnXPOcMgXg118U/mhYjfpxBk99q5OL/lSF5y9v33vFLx8v2yx4zK9ev/+sUJsEvjLwgYBaAlheazxTfSeZ/D1Xjl1++JJvLAvR/piZ339VSBLw+SNAH3SGr6LzTPYDB+lIKVTl/l+qX6AGaEPPXwKIaLGMiqyDFXSkPJRukIVxSufW/WFJwlNSA0gCnhAsWeBky2YUkvt7Zj79pkC1wIf3lgteyfSzTCWwXGDmG8s2b3Sw+S0KvyUrp3yK0wi8s8RD6dApkoyHRJPOw8yP3STffeOJMkbpDHlhMiQEKPX38ZoSDzTzxlunFwoYPnPTwr3uNJlpqAGm+dpv0csMnr7pNJTfPbz24v17BDw4v2xz9J0BAB6cW/afSHu+ELSlv29r9hk8uODkAgobt0anDh6jA3L4RD4EnzooojHwiZNRGGzvSCukslsNnkPHOSy4uCBZf11uD+VoT7QpH/D6HJHGwMAaX/r9EuWl26w8+cCFJ1fOzpS2dBFAIQLqbClNE2IGgKZO4vlzMp5K+zssPC5OwNe8PvEfhdpFgcXrdYsCQp0CMPZnhXTPEhuPk+mX271uul/qTYZfxnjq33nNjn3fkSrm9ecv7xI/Nxje0DPAw+9FfO8mdq9r7qcrzw2Gq9duKYwO3xfzetX6fbweJsPegUdfRoHv0ZEu4nWU9u+kfnhI6gx7Tz9TSDr3fUfK6vUEQPv7iJOA6Az9K/7EKPB9R8rwOjwkamL3lzH9BtRDZ0j8FPM49j2yGd3rBIXSmab7n0g7rHXAte+pY5rudRKFFovv6XoEsdYB575v17wujHOybPPw2kux+y+uHQ6hMxA9OK/xuPR9AfkTnIcI+BRF4bbo5OGjxw6ewraANAYROXJqS2gysBvfB4wIIZOA169b05GlaBei3Lo10sYaA7Ant97gAYCYES4OAMSITR930l0hVs6qSInBAJDBYwF1skRE8lbTL+6d7cFufRtDIR5mUXHabYvWYVutbze94+FPtZo+CXzhO7r1i5jeeSYXM/0zjWFkpndTWYqZvjq3j6lqhKZ3Ykur6RNQpX4IKh1hh+2k27aanuCl2gJiwchM76Tbtpm+JuEh1RGQpEZoeqfd9hOZWaqQyYYQGqHpnXbbdHpdi8K0eDMqgDWut92RbnpeG21eHleAgBgiyzdHRUzv+BDkjx/WfW5WAP0FwMdtpnd9YWOBI83nLEYFMCqBsN30rodYP0oAYpCIWNFGwRJjQCOACAwKy4Dgx5AD"}),I("h1",null,"model-asset-preview")],-1),G={key:0,class:"d-flex"},X={class:"control"},H=I("h2",null,"Quality:",-1),J=z('<option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="6">6x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option>',8),Z={class:"control"},N=I("h2",null,"Zoom:",-1),Q={class:"control"},V=I("h2",null,"Background:",-1),K={class:"control"},W=I("h2",null,"Model:",-1),_={class:"control"},$=I("h2",null,"Texture:",-1),ee={class:"control"},te={key:1,style:{"text-align":"center"}};D(p({expose:[],setup(e){const t=g(void 0);async function a(e){var a;const n=e.target,i=null==(a=null==n?void 0:n.files)?void 0:a[0];if(!i)return;const s=JSON.parse(await i.text());if(s["minecraft:geometry"])t.value=s["minecraft:geometry"][0];else{const e=Object.values(s).find((e=>"string"!=typeof e));if(!e)return;const a={description:{},bones:[]};a.description.texture_width=e.texturewidth,a.description.texture_height=e.textureheight,a.bones=e.bones,t.value=a}}const n=g(void 0);async function i(e){var t;const a=e.target,i=null==(t=null==a?void 0:a.files)?void 0:t[0];if(!i)return;const s=new FileReader;s.addEventListener("load",(()=>{"string"==typeof s.result&&(n.value=s.result)})),s.addEventListener("error",(e=>console.error(e))),s.readAsDataURL(i)}const s=g("4"),o=m((()=>Number(s.value))),r=g("1.5"),l=m((()=>Number(r.value)));B("zoom",l);const d=g("#121212"),u=m((()=>Number(d.value.replace("#","0x"))));function h(){p.value=!1}B("backgroundColor",u),(async()=>{var e;d.value=null!=(e=await E("backgroundColor"))?e:"#121212",b((async()=>{console.log(d.value),await O("backgroundColor",d.value)}))})();const c=m((()=>!!t.value&&!!n.value)),p=g(!1);function v(){p.value=!0}function w(){confirm("Are you sure that you want to reset the current preview?")&&location.reload()}return B("startRender",p),(e,l)=>(y(),R(M,null,[T,p.value?(y(),R("p",te,"Loading...")):(y(),R("div",G,[I("div",X,[H,A(I("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>s.value=e)},[J],512),[[q,s.value]])]),I("div",Z,[N,A(I("input",{type:"number","onUpdate:modelValue":l[2]||(l[2]=e=>r.value=e)},null,512),[[Y,r.value]])]),I("div",Q,[V,A(I("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=e=>d.value=e)},null,512),[[Y,d.value]])]),I("div",K,[W,I("input",{type:"file",onChange:a},null,32)]),I("div",_,[$,I("input",{type:"file",onChange:i},null,32)]),I("div",ee,[I("button",{class:"render-button",style:{"margin-right":"12px"},onClick:w,disabled:!x(c)}," Reset ",8,["disabled"]),I("button",{class:"render-button",onClick:v,disabled:!x(c)}," Render ",8,["disabled"])]),x(c)?(y(),R(U,{key:0,startRender:p.value,model:t.value,texture:n.value,quality:x(o),onReady:h},null,8,["startRender","model","texture","quality"])):k("",!0)]))],64))}})).mount("#app");
